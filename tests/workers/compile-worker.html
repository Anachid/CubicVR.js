<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN">
<html>
  <head>
    <title>CubicVR.js Compile-in-Worker Example</title>
      <script src="../../CubicVR.js" type="text/javascript"></script>
      <script type='text/javascript'>
        document.addEventListener('DOMContentLoaded', function (e) {
          var gl = CubicVR.init();
          var canvas = CubicVR.getCanvas();

          if (!gl) {
              alert("Sorry, no WebGL support.");
              return;
          };

          var boxMaterial = new CubicVR.Material({
            textures: {
              color: new CubicVR.Texture("../../samples/images/crate.jpg"),
              alpha: new CubicVR.Texture("../../samples/images/crate-alpha.jpg"),
            }
          });

          var boxMesh = CubicVR.primitives.box({
            size: 1.0,
            material: boxMaterial,
            uvmapper: {
              projectionMode: CubicVR.enums.uv.projection.CUBIC,
              scale: [1, 1, 1]
            }
          });

          // New scene with our canvas dimensions and default camera with FOV 80
          var scene = new CubicVR.Scene(canvas.width, canvas.height, 80,0.1,150.0);

          var worker = CubicVR.Worker({
            type: "prepareMesh",
            data: boxMesh,
            message: function (data) {

              boxMesh.bindBuffer(boxMesh.bufferVBO(data.data));

              var boxObject = [];

              for (var i = 0; i < 64; i ++) {
                boxObject[i] = new CubicVR.SceneObject({mesh:boxMesh,position:[(Math.random()-0.5)*15.0,(Math.random())*6.0-1.0,(Math.random()-0.5)*15.0]});
                scene.bindSceneObject(boxObject[i]);
              }

              CubicVR.setGlobalAmbient([0.3,0.3,0.3]);

              scene.camera.position = [6, 6, 6];
              scene.camera.target = [0, 0, 0];
                
              CubicVR.addResizeable(scene);

              CubicVR.MainLoop(function(timer, gl) {
                var seconds = timer.getSeconds();
                  
                for (var i = 0; i < boxObject.length; i++) {
                  boxObject[i].rotation = [5*i+seconds*60,0,5*i+seconds*50];
                }
                  
                scene.render();
                  
              });

              var mvc = new CubicVR.MouseViewController(canvas, scene.camera);
            },
            error: function (data) {
            },
          });

        }, false);
    </script>
  </head>
  <body>
  </body>
</html>
